<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Front End APIRestFull</title>
  </head>
  <style>
    .hidden{
      display: none;
    }
  </style>
  <body>
    <h2>Listagem de produtos</h2>

    <ul id="produtos"></ul>
    <hr />

    <h2>Cadastro de Produtos</h2>
    <form id="formu">
      <div>
        <label> Nome</label>
        <input type="text" name="name" />
      </div>
      <div>
        <label> Marca</label>
        <input type="text" name="Brand" />
      </div>
      <div>
        <label>Preço</label>
        <input type="text" name="price" />
      </div>
      <div>
        <button type="submit">Cadastrar</button>
      </div>
    </form>
    
    <div id="edit" class="hidden">
      <hr>
      <h2> Altere os dados do seu Produto</h2>
      <form id="form">
        <input type="hidden" name="id">
        <div>
          <label> Nome</label>
          <input type="text" name="name" />
        </div>
        <div>
          <label> Marca</label>
          <input type="text" name="Brand" />
        </div>
        <div>
          <label>Preço</label>
          <input type="text" name="price" />
        </div>
        <div>
          <button type="submit">Alterar</button>
        </div>
      </form>
    </div>

    <script>
      const URL_API = "http://localhost:8080/api/produtos";
      
      const edit = document.querySelector("#edit")
      const form = document.querySelector('#form')
      const formulario = document.querySelector("#formu");
      const listadeprodutos = document.querySelector("#produtos");

      //OBTEM A LISTA DE PRODUTOS  
      function carregarAutomatico(){
        fetch(URL_API).then(response => {
        response.json().then(data => {
          const produtosHTML = data.map((product) => `
              <li>
                ${product.name} - ${product.Brand} - ${product.price} -
                <a href="#" class="botao-editar"
                data-id= "${product._id}"
                data-name="${product.name}"
                data-Brand="${product.Brand}"
                data-price="${product.price}"
                >
                [Editar]</a>
                <a href="#" class="botao-excluir" data-id="${product._id}">[Excluir]</a>-
              </li>
              `
              )
            .join("");

          listadeprodutos.innerHTML = produtosHTML;

          Excluindo()
          Editando()

        })
      })
      }

      carregarAutomatico()
      

      // Selecionando o botao de editar e clicando nele para editar
      function Editando(){
        const Editar = document.querySelectorAll('.botao-editar')
          Editar.forEach(botao =>{
            botao.onclick = function(e){
              e.preventDefault()

              edit.classList.remove('hidden')
               
              const id = this.dataset.id
              const name = this.dataset.name
              const Brand = this.dataset.brand
              const price = this.dataset.price

              document.forms['form'].id.value = id
              document.forms['form'].name.value = name
              document.forms['form'].Brand.value = Brand
              document.forms['form'].price.value = price
              
            }
          })
          }
      // Ao editar um produto no formulario 
      form.onsubmit = function(e){
        e.preventDefault() 
        const id = document.forms['form'].id.value
        const name = document.forms["form"].name.value
        const Brand = document.forms["form"].Brand.value
        const price = document.forms["form"].price.value

        
              fetch(`${URL_API}/${id}`,{
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  name,
                  Brand,
                  price,
                }),
              }).then(response =>{
                response.json().then(data =>{
                  if(data.message === 'Produto Atualizado com sucesso'){
                    form.reset()
                    edit.classList.add('hidden')
                     alert('Produto editado com sucesso')
                     carregarAutomatico()
                  }else{
                    alert('Ops, falha ao tentar editar o produto')
                  }
                })
              })
             

      }
      
      //Exclui Produtos 
      function Excluindo(){
            const Excluir = document.querySelectorAll('.botao-excluir')
          Excluir.forEach(botao =>{
            botao.onclick = function(e){
              e.preventDefault()

              const id = this.dataset.id
              fetch(`${URL_API}/${id}`,{
                method: 'DELETE'
              }).then(response =>{
                response.json().then(data =>{
                  if(data.message === 'Produto removido com sucesso'){
                     alert('Produto excluido com sucesso')
                     carregarAutomatico()
                  }else{
                    alert('Ops, falha ao remover o produto')
                  }
                })
              })
            }
          })
          }
      
      // CADASTRANDO PRODUTO 
      formulario.onsubmit = function (e) {
        e.preventDefault();

        const name = document.forms["formu"].name.value;
        const Brand = document.forms["formu"].Brand.value;
        const price = document.forms["formu"].price.value;

        fetch(URL_API, {
          method: "POST",
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name,
            Brand, 
            price,
          }),
        }).then(response => {
          response.json().then(data =>{
            console.log(data)
            if (data.message === 'Requisiçao de dados feita para a APIRestFull com sucesso'){
              carregarAutomatico()
              alert('Cadastro realizado com sucesso')
            }else{
              alert('Ops deu erro')
            }
          })
        })
      }
      
      
      
    
    
    
    </script>

    
  </body>
</html>

